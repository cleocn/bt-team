define(["exports","/Public/build/base.js"],function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(e,"__esModule",{value:!0}),e.html=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=e.html=function(e){function t(){n(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._event_init(),e}return i(t,e),r(t,[{key:"_event_init",value:function(){this.event(),this.editor_init(),this.editor_node_init(),this.title_init(),this.login()}},{key:"event",value:function(){$(".logout").click(function(){QC.Login.signOut(),location.href=_config.CONTROLLER_NAME})}},{key:"login",value:function(){var e=this,t=this;setTimeout(function(){if(null==_config.userinfo){$(".banner-content").removeClass("hide");layer.open({type:1,title:!1,closeBtn:0,shadeClose:!1,skin:"layer_login",content:""}),$(".layui-layer-page").remove(),_config.userinfo={userid:1,color:"#000"},t.default(!1),QC.Login({btnId:"login"})}},500),QC.api("get_user_info",{}).success(function(n){$(".navbar-nav").removeClass("hide"),$(".banner-content").addClass("hide"),$(".layui-layer-shade").remove(),e.close(),_config.userinfo=n.data,$(".user img").attr("src",_config.userinfo.figureurl_qq_2);var o={url:_config.CONTROLLER_NAME+"/save",data:_config.userinfo};t.ajax(o,function(t){_config.userinfo.userid=t.userid,_config.userinfo.color=t.color,e.default(!0)})})}},{key:"default",value:function(e){var t='<div>BT文档是一款支持「多人实时协作」的文档设计工具，你可以和别人一起同时进行一个文档制作，你们能够互相看到对方的状态，以及每个人的每一步操作与结果。<br></div><div>BT文档只是仿业内“石墨”的一个非常非常初级的版本，意在本人探索和偿试新产品下的技术原理实现~</div><div><br><video loop="loop" class="embed-responsive-item" id="fullVideo" autoplay="autoplay" controls=""><source src="https://dn-site.oss.aliyuncs.com/videos%2F60s_go_to_work.mp4?response-content-type=video/mp4" type="video/mp4"></video></div>',n="BT-文档 多人实时协作工具";if(e&&(t="<div>Hello World</div>",n="无标题"),$("#edit-box").html(t),$("#title").val(n),document.title=$("#title").val(),$(".dropdown-menu li:first a").html(_config.userinfo.nickname),document.all)window.style=".row-"+_config.userinfo.userid+"{border-left:2px solid "+_config.userinfo.color+";padding-left:10px;}",document.createStyleSheet("javascript:style");else{var o=document.createElement("style");o.type="text/css",o.innerHTML=".row-"+_config.userinfo.userid+"{ border-left:2px solid "+_config.userinfo.color+";padding-left:10px;}",document.getElementsByTagName("HEAD").item(0).appendChild(o)}}},{key:"title_init",value:function(){$("#title").keyup(function(){document.title=$(this).val()||"无标题"})}},{key:"editor_node_init",value:function(){var e=this,t=this;node.addEventListener("input",function(n){0==$("#edit-box div").size()&&t.default(),_is_back=!1;var o=e.getSelectionStart();if(void 0!=o&&1===o.nodeType&&"DIV"==o.nodeName){_is_back=!1;var i=$("#edit-box div").size()+1,r=$(o);socket._emit({author:"row-"+_config.userinfo.userid,line:i,txt:r.html(),key:r.attr("key"),style:r.attr("style"),userinfo:_config.userinfo})}},!1),node.addEventListener("DOMNodeInserted",function(e){if(!_is_back){var t=$(e.target),n=$("#edit-box div").size()+1,o=Math.round(1e6*Math.random());"DIV"==t.context.nodeName&&t.attr("class","row-"+_config.userinfo.userid+"-"+n).attr("key",o).addClass("row-"+_config.userinfo.userid)}},!1)}},{key:"editor_init",value:function(){var e=this;$(".html .Controls a").click(function(t){switch($(this).data("role")){case"h1":case"h2":case"p":document.execCommand("formatBlock",!1,"<"+$(this).data("role")+">");break;default:document.execCommand($(this).data("role"),!1,null);var n=$(e.getSelected().baseNode.parentElement),o=n.context.className;o||(n=$(n.context.parentNode),o=n.context.parentNode.className);var i=o.split("-");socket._emit({author:i[0]+"-"+i[1],line:i[2],txt:n.html(),key:n.attr("key")})}})}},{key:"getSelected",value:function(){return window.getSelection?window.getSelection():document.getSelection?document.getSelection():document.selection?document.selection.createRange():null}},{key:"getSelectionStart",value:function(){var e=document.getSelection().anchorNode;return 3==e.nodeType?e.parentNode:e}}]),t}(t.base);window.html=new a});