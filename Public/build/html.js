define(["exports","Public/build/base.js"],function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(e,"__esModule",{value:!0}),e.html=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=e.html=function(e){function t(){n(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._event_init(),e}return r(t,e),i(t,[{key:"_event_init",value:function(){function e(){var e=document.getSelection().anchorNode;return 3==e.nodeType?e.parentNode:e}var t=this;$(".html .Controls a").click(function(e){switch($(this).data("role")){case"h1":case"h2":case"p":document.execCommand("formatBlock",!1,"<"+$(this).data("role")+">");break;default:document.execCommand($(this).data("role"),!1,null);var n=$(t.getSelected().baseNode.parentElement),o=n.context.className;o||(n=$(n.context.parentNode),o=n.context.parentNode.className);var r=o.split("-");socket._emit({author:r[0]+"-"+r[1],line:r[2],txt:n.html(),key:n.attr("key")})}}),node.addEventListener("input",function(t){_is_back=!1;var n=e();if(void 0!=n&&1===n.nodeType&&"DIV"==n.nodeName){_is_back=!1;var o=$("#edit-box div").size()+1,r=$(n);socket._emit({author:"row-"+_config.userid,line:o,txt:r.html(),key:r.attr("key")})}},!1),node.addEventListener("DOMNodeInserted",function(e){if(!_is_back){var t=$(e.target),n=$("#edit-box div").size()+1,o=Math.round(1e6*Math.random());t.attr("class","row-"+_config.userid+"-"+n).attr("key",o).addClass("row-"+_config.userid)}},!1),$("#edit-box").html("<div>Start</div>"),$("#edit-box div").focus()}},{key:"getSelected",value:function(){return window.getSelection?window.getSelection():document.getSelection?document.getSelection():document.selection?document.selection.createRange():null}}]),t}(t.base);window.html=new a});